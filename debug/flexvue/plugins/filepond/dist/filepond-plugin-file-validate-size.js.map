{"version":3,"file":"filepond-plugin-file-validate-size.js","names":["global","factory","exports","module","define","amd","self","FilePondPluginFileValidateSize","plugin","_ref","addFilter","utils","Type","replaceInString","toNaturalFileSize","file","_ref2","query","sizeMax","size","sizeMin","_ref3","Promise","resolve","reject","fileFilter","status","main","sub","filesize","totalSizeMax","currentTotalSize","reduce","total","item","fileSize","options","allowFileSizeValidation","BOOLEAN","maxFileSize","INT","minFileSize","maxTotalFileSize","fileValidateSizeFilter","FUNCTION","labelMinFileSizeExceeded","STRING","labelMinFileSize","labelMaxFileSizeExceeded","labelMaxFileSize","labelMaxTotalFileSizeExceeded","labelMaxTotalFileSize","isBrowser","window","document","dispatchEvent","CustomEvent","detail"],"sources":["filepond-plugin-file-validate-size.js"],"sourcesContent":["\"use strict\";\n/*!\n * FilePondPluginFileValidateSize 2.2.1\n * Licensed under MIT, https://opensource.org/licenses/MIT/\n * Please visit https://pqina.nl/filepond/ for details.\n */\n/* eslint-disable */\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined'\n        ? (module.exports = factory())\n        : typeof define === 'function' && define.amd\n            ? define(factory)\n            : ((global = global || self),\n                (global.FilePondPluginFileValidateSize = factory()));\n})(this, function () {\n    'use strict';\n    var plugin = function plugin(_ref) {\n        var addFilter = _ref.addFilter, utils = _ref.utils;\n        // get quick reference to Type utils\n        var Type = utils.Type, replaceInString = utils.replaceInString, toNaturalFileSize = utils.toNaturalFileSize;\n        // filtering if an item is allowed in hopper\n        addFilter('ALLOW_HOPPER_ITEM', function (file, _ref2) {\n            var query = _ref2.query;\n            if (!query('GET_ALLOW_FILE_SIZE_VALIDATION')) {\n                return true;\n            }\n            var sizeMax = query('GET_MAX_FILE_SIZE');\n            if (sizeMax !== null && file.size >= sizeMax) {\n                return false;\n            }\n            var sizeMin = query('GET_MIN_FILE_SIZE');\n            if (sizeMin !== null && file.size <= sizeMin) {\n                return false;\n            }\n            return true;\n        });\n        // called for each file that is loaded\n        // right before it is set to the item state\n        // should return a promise\n        addFilter('LOAD_FILE', function (file, _ref3) {\n            var query = _ref3.query;\n            return new Promise(function (resolve, reject) {\n                // if not allowed, all fine, exit\n                if (!query('GET_ALLOW_FILE_SIZE_VALIDATION')) {\n                    return resolve(file);\n                }\n                // check if file should be filtered\n                var fileFilter = query('GET_FILE_VALIDATE_SIZE_FILTER');\n                if (fileFilter && !fileFilter(file)) {\n                    return resolve(file);\n                }\n                // reject or resolve based on file size\n                var sizeMax = query('GET_MAX_FILE_SIZE');\n                if (sizeMax !== null && file.size >= sizeMax) {\n                    reject({\n                        status: {\n                            main: query('GET_LABEL_MAX_FILE_SIZE_EXCEEDED'),\n                            sub: replaceInString(query('GET_LABEL_MAX_FILE_SIZE'), {\n                                filesize: toNaturalFileSize(sizeMax)\n                            })\n                        }\n                    });\n                    return;\n                }\n                // reject or resolve based on file size\n                var sizeMin = query('GET_MIN_FILE_SIZE');\n                if (sizeMin !== null && file.size <= sizeMin) {\n                    reject({\n                        status: {\n                            main: query('GET_LABEL_MIN_FILE_SIZE_EXCEEDED'),\n                            sub: replaceInString(query('GET_LABEL_MIN_FILE_SIZE'), {\n                                filesize: toNaturalFileSize(sizeMin)\n                            })\n                        }\n                    });\n                    return;\n                }\n                // returns the current option value\n                var totalSizeMax = query('GET_MAX_TOTAL_FILE_SIZE');\n                if (totalSizeMax !== null) {\n                    // get the current total file size\n                    var currentTotalSize = query('GET_ACTIVE_ITEMS').reduce(function (total, item) {\n                        return total + item.fileSize;\n                    }, 0);\n                    // get the size of the new file\n                    if (currentTotalSize > totalSizeMax) {\n                        reject({\n                            status: {\n                                main: query('GET_LABEL_MAX_TOTAL_FILE_SIZE_EXCEEDED'),\n                                sub: replaceInString(query('GET_LABEL_MAX_TOTAL_FILE_SIZE'), {\n                                    filesize: toNaturalFileSize(totalSizeMax)\n                                })\n                            }\n                        });\n                        return;\n                    }\n                }\n                // file is fine, let's pass it back\n                resolve(file);\n            });\n        });\n        return {\n            options: {\n                // Enable or disable file type validation\n                allowFileSizeValidation: [true, Type.BOOLEAN],\n                // Max individual file size in bytes\n                maxFileSize: [null, Type.INT],\n                // Min individual file size in bytes\n                minFileSize: [null, Type.INT],\n                // Max total file size in bytes\n                maxTotalFileSize: [null, Type.INT],\n                // Filter the files that need to be validated for size\n                fileValidateSizeFilter: [null, Type.FUNCTION],\n                // error labels\n                labelMinFileSizeExceeded: ['File is too small', Type.STRING],\n                labelMinFileSize: ['Minimum file size is {filesize}', Type.STRING],\n                labelMaxFileSizeExceeded: ['File is too large', Type.STRING],\n                labelMaxFileSize: ['Maximum file size is {filesize}', Type.STRING],\n                labelMaxTotalFileSizeExceeded: [\n                    'Maximum total size exceeded',\n                    Type.STRING\n                ],\n                labelMaxTotalFileSize: [\n                    'Maximum total file size is {filesize}',\n                    Type.STRING\n                ]\n            }\n        };\n    };\n    // fire pluginloaded event if running in browser, this allows registering the plugin when using async script tags\n    var isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n    if (isBrowser) {\n        document.dispatchEvent(new CustomEvent('FilePond:pluginloaded', { detail: plugin }));\n    }\n    return plugin;\n});\n"],"mappings":"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","ignoreList":[]}